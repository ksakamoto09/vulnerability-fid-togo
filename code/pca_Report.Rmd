---

title: "PCA vs Autoencoder Togo"
author: "Kaz Sakamoto"
date: "8/1/2021"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)

### set root directory
root <- rprojroot::find_rstudio_root_file()
```

```{r readData}

## read in data
df <- read_csv(file.path(root,"data", "combined_20210622.csv"))

## pivot dataframe
dfwide <- df %>% pivot_wider(names_from = indicators, values_from = value)

# select TOGO
togoLong <- dfwide %>% filter(adm_0 == "TGO")

## add RIWI
togoRIWI <- sf::st_read(file.path(root,"shapes", "TGO_RIWI.geojson"))

# scaling
scale_this <- function(x) as.vector(scale(x))

togoScale <- togoLong %>% left_join(togoRIWI %>% sf::st_drop_geometry() %>%
                               select(ADM_3, RIWI) %>%
                               dplyr::rename(adm_3 = ADM_3)) %>%
  mutate_if(is.double, scale_this) %>%
                      select(schools:RIWI, - population)
togo <- togoLong %>% left_join(togoRIWI %>% sf::st_drop_geometry() %>%
                               select(ADM_3, RIWI) %>%
                               dplyr::rename(adm_3 = ADM_3)) %>%
                      select(schools:RIWI, - population)
togo
```

## PCA

```{r pca}
# run PCA as is
togoPCA <- prcomp(togo, center = TRUE, scale. = TRUE)
```

```{r}
tibble(stdDev = cumsum(togoPCA$sdev)/sum(togoPCA$sdev),
       PC = 1:12) %>%
  ggplot(aes(PC, stdDev)) +
  geom_line()
```

```{r}
as.data.frame(togoPCA$x) %>%
  mutate(admin = togoLong$adm_1) %>%
ggplot(aes(x = PC1, y = PC2, color = admin)) + geom_point() +
  xlim(-3,5) +
  theme_minimal()
```

